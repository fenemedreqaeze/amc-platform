version: "3.9"
services:
  api:
    build: ./api
    container_name: amc-api
    environment:
      - AMC_DATA_DIR=/amc/data
      - CORS_ORIGINS=*
      # ------ (optionnel Stripe en dev) ------
      # - STRIPE_SECRET_KEY=sk_test_xxx
      # - STRIPE_PRICE_ID_PRO=price_xxx
      # - STRIPE_WEBHOOK_SECRET=whsec_xxx
      # - SUCCESS_URL=https://example.com/success
      # - CANCEL_URL=https://example.com/cancel
    volumes:
      - ./data:/amc/data
    ports:
      - "8000:8000"
    networks: [web]

  frontend:
    build: ./frontend
    container_name: amc-frontend
    # Expose 3000 côté Codespaces, mappé vers 80 du conteneur Nginx
    ports:
      - "3000:80"
    depends_on:
      - api
    networks: [web]

networks:
  web:
    external: false
