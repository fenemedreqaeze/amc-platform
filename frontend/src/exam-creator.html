<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cr√©ateur d'examen</title>
  <style>
    :root {
      --bg: #0f172a;         /* slate-900 */
      --card: #111827;       /* gray-900 */
      --muted: #1f2937;      /* gray-800 */
      --text: #e5e7eb;       /* gray-200 */
      --soft: #9ca3af;       /* gray-400 */
      --primary: #60a5fa;    /* blue-400 */
      --primary-600: #2563eb;/* blue-600 */
      --success: #22c55e;    /* green-500 */
      --danger: #ef4444;     /* red-500 */
      --danger-600: #dc2626; /* red-600 */
      --shadow: rgba(0,0,0,.35);
      
      /* Couleurs par mati√®re */
      --maths: #e74c3c;      /* Rouge */
      --french: #3498db;     /* Bleu */
      --english: #9b59b6;    /* Violet */
      --history: #e67e22;    /* Orange */
      --geography: #27ae60;  /* Vert */
      --science: #f39c12;    /* Jaune */
      --other: #95a5a6;      /* Gris */
    }

    html, body { margin: 0; padding: 0; background: var(--bg); color: var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, sans-serif; }

    .container { max-width: 980px; margin: 32px auto; padding: 0 16px; }

    h1 { font-size: 28px; font-weight: 700; margin: 0 0 20px; letter-spacing: .3px; }
    h3 { margin: 0 0 12px; font-size: 18px; }

    .exam-header {
      background: var(--card);
      border: 1px solid var(--muted);
      border-radius: 14px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 6px 20px var(--shadow);
    }

    .exam-meta {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 15px;
    }

    .exam-meta label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: var(--soft);
    }

    select {
      width: 100%;
      background: #0b1220;
      color: var(--text);
      border: 1px solid var(--muted);
      border-radius: 10px;
      padding: 10px 12px;
      outline: none;
    }

    .question-card {
      background: var(--card);
      border: 1px solid var(--muted);
      border-radius: 14px;
      padding: 16px;
      margin: 16px 0;
      box-shadow: 0 6px 20px var(--shadow);
      transition: border-color 0.3s ease;
    }

    /* Styles par mati√®re */
    .subject-maths { border-left: 4px solid var(--maths); }
    .subject-french { border-left: 4px solid var(--french); }
    .subject-english { border-left: 4px solid var(--english); }
    .subject-history { border-left: 4px solid var(--history); }
    .subject-geography { border-left: 4px solid var(--geography); }
    .subject-science { border-left: 4px solid var(--science); }
    .subject-other { border-left: 4px solid var(--other); }

    textarea, input[type="text"] {
      width: 100%;
      resize: vertical;
      background: #0b1220;
      color: var(--text);
      border: 1px solid var(--muted);
      border-radius: 10px;
      padding: 10px 12px;
      margin-bottom: 12px;
      outline: none;
    }

    .answer-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 8px 0;
      padding: 10px;
      background: #0b1220;
      border: 1px solid var(--muted);
      border-radius: 10px;
    }

    .answer-row.correct-answer { border-color: var(--primary); box-shadow: inset 0 0 0 1px rgba(96,165,250,.35); }

    .answer-row input[type="text"] {
      background: transparent;
      border: none;
      border-left: 1px solid var(--muted);
      padding: 8px 10px;
      color: var(--text);
      outline: none;
    }

    .btn-primary, .btn-success, .btn-danger {
      border: none;
      border-radius: 12px;
      padding: 10px 14px;
      cursor: pointer;
      font-weight: 600;
      color: white;
      transition: transform .04s ease, filter .08s ease, opacity .2s ease;
    }

    .btn-primary { background: var(--primary-600); }
    .btn-success { background: var(--success); color: #052e0f; }
    .btn-danger { background: var(--danger); }

    .btn-primary:active, .btn-success:active, .btn-danger:active { transform: translateY(1px); }
    .btn-danger:hover { filter: brightness(.95); }

    .actions { text-align: center; margin-top: 24px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }

    .sub-actions { display: flex; gap: 8px; margin-top: 10px; }

    .note { color: var(--soft); font-size: 13px; margin-top: 8px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Cr√©ateur d'examen</h1>

    <!-- En-t√™te de l'examen avec m√©tadonn√©es -->
    <div class="exam-header">
      <input type="text" placeholder="Titre de l'examen" style="font-size: 1.3em; font-weight: bold; background: transparent; border: none; color: var(--text); outline: none; width: 100%;">
      <textarea placeholder="Description de l'examen..." rows="2" style="margin-top: 10px;"></textarea>
      
      <div class="exam-meta">
        <div>
          <label for="subject-select">üìö Mati√®re</label>
          <select id="subject-select">
            <option value="maths">üìê Math√©matiques</option>
            <option value="french">üìñ Fran√ßais</option>
            <option value="english">üî§ Anglais</option>
            <option value="history">üèõÔ∏è Histoire</option>
            <option value="geography">üåç G√©ographie</option>
            <option value="science">üî¨ Sciences</option>
            <option value="other">üìö Autre mati√®re</option>
          </select>
        </div>
        <div>
          <label for="exam-difficulty">üéØ Niveau</label>
          <select id="exam-difficulty">
            <option value="easy">üü¢ Facile</option>
            <option value="medium">üü° Moyen</option>
            <option value="hard">üî¥ Difficile</option>
          </select>
        </div>
      </div>
    </div>

    <div id="questions-container"></div>

    <!-- Boutons d'action -->
    <div class="actions">
      <button type="button" class="btn-success" onclick="addQuestion()">‚ûï Ajouter une Question</button>
      <button type="button" class="btn-primary" onclick="saveExam()">üíæ Sauvegarder l'Examen</button>
      <button type="button" class="btn-primary" onclick="goBack()">‚Üê Retour √† l'accueil</button>
    </div>

    <p class="note">Astuce¬†: marque la bonne r√©ponse en cochant le bouton radio correspondant. Tu peux ajouter/supprimer des r√©ponses librement.</p>
  </div>

  <script>
    let questionCount = 0;
    let currentSubject = 'maths';

    function updateQuestionStyles() {
      document.querySelectorAll('.question-card').forEach(card => {
        // Retirer toutes les classes de mati√®re
        card.classList.remove('subject-maths', 'subject-french', 'subject-english', 'subject-history', 'subject-geography', 'subject-science', 'subject-other');
        // Ajouter la classe de mati√®re actuelle
        card.classList.add(`subject-${currentSubject}`);
      });
    }

    function addQuestion() {
      questionCount++;
      const questionsContainer = document.getElementById('questions-container');

      const questionDiv = document.createElement('div');
      questionDiv.className = `question-card subject-${currentSubject}`;
      questionDiv.id = `question-${questionCount}`;
      questionDiv.innerHTML = `
        <h3>Question ${questionCount}</h3>
        <textarea placeholder="√ânonc√© de la question..." rows="3"></textarea>

        <div class="answer-row correct-answer">
          <input type="radio" name="correct-${questionCount}" checked>
          <input type="text" placeholder="R√©ponse correcte" style="flex: 1;">
          <button type="button" class="btn-danger answer-remove">‚úï</button>
        </div>

        <div class="answer-row">
          <input type="radio" name="correct-${questionCount}">
          <input type="text" placeholder="Mauvaise r√©ponse" style="flex: 1;">
          <button type="button" class="btn-danger answer-remove">‚úï</button>
        </div>

        <div class="sub-actions">
          <button type="button" class="btn-success add-answer-btn" data-id="${questionCount}">‚ûï Ajouter une r√©ponse</button>
          <button type="button" class="btn-danger remove-question-btn" data-id="${questionCount}">üóëÔ∏è Supprimer cette question</button>
        </div>
      `;

      questionsContainer.appendChild(questionDiv);

      // === √âV√âNEMENTS SP√âCIFIQUES √Ä CETTE QUESTION ===

      // 1) Ajouter une r√©ponse
      const addBtn = questionDiv.querySelector('.add-answer-btn');
      addBtn.addEventListener('click', function (e) {
        e.stopPropagation();
        addAnswer(this.getAttribute('data-id'));
      });

      // 2) Supprimer la question (un seul handler, pas de handler g√©n√©rique)
      const removeBtn = questionDiv.querySelector('.remove-question-btn');
      removeBtn.addEventListener('click', function (e) {
        e.stopPropagation();
        removeQuestion(this.getAttribute('data-id'));
      });

      // 3) Supprimer une r√©ponse (ne cible QUE les boutons de ligne-r√©ponse)
      const answerDeleteBtns = questionDiv.querySelectorAll('.answer-remove');
      answerDeleteBtns.forEach(btn => {
        btn.addEventListener('click', function (e) {
          e.stopPropagation();
          this.parentElement.remove();
        });
      });

      // 4) Styling visuel de la bonne r√©ponse
      const radios = questionDiv.querySelectorAll(`input[type="radio"][name="correct-${questionCount}"]`);
      radios.forEach(r => {
        r.addEventListener('change', () => {
          questionDiv.querySelectorAll('.answer-row').forEach(row => row.classList.remove('correct-answer'));
          const row = r.closest('.answer-row');
          if (row) row.classList.add('correct-answer');
        });
      });
    }

    function addAnswer(questionId) {
      const question = document.getElementById(`question-${questionId}`);
      if (!question) return;

      const newAnswer = document.createElement('div');
      newAnswer.className = 'answer-row';
      newAnswer.innerHTML = `
        <input type="radio" name="correct-${questionId}">
        <input type="text" placeholder="Nouvelle r√©ponse" style="flex: 1;">
        <button type="button" class="btn-danger answer-remove">‚úï</button>
      `;

      // Supprimer cette r√©ponse
      newAnswer.querySelector('.answer-remove').addEventListener('click', function (e) {
        e.stopPropagation();
        this.parentElement.remove();
      });

      // Mettre en surbrillance si coch√©e
      const radio = newAnswer.querySelector('input[type="radio"]');
      radio.addEventListener('change', () => {
        question.querySelectorAll('.answer-row').forEach(row => row.classList.remove('correct-answer'));
        newAnswer.classList.add('correct-answer');
      });

      // Ins√©rer juste avant les sous-actions (boutons Ajouter/Supprimer)
      const subActions = question.querySelector('.sub-actions');
      question.insertBefore(newAnswer, subActions);
    }

    function removeQuestion(questionId) {
      const node = document.getElementById(`question-${questionId}`);
      if (node) node.remove();
    }

    function saveExam() {
      const subject = document.getElementById('subject-select');
      const difficulty = document.getElementById('exam-difficulty');
      const title = document.querySelector('input[placeholder*="Titre"]').value || 'Sans titre';
      const subjectText = subject.options[subject.selectedIndex].text;
      const difficultyText = difficulty.options[difficulty.selectedIndex].text;
      
      // Esquisse de s√©rialisation (pour plus tard)
      const payload = { 
        title,
        subject: currentSubject,
        difficulty: difficulty.value,
        questions: [] 
      };
      
      document.querySelectorAll('.question-card').forEach((qCard, idx) => {
        const statement = qCard.querySelector('textarea')?.value || '';
        const answers = [];
        const name = `correct-${idx + 1}`;
        const correctIndex = Array.from(qCard.querySelectorAll(`input[type="radio"][name="${name}"]`)).findIndex(r => r.checked);
        qCard.querySelectorAll('.answer-row').forEach((row) => {
          const text = row.querySelector('input[type="text"]').value || '';
          answers.push(text);
        });
        payload.questions.push({ statement, answers, correctIndex });
      });

      alert(`üéâ Examen "${title}" sauvegard√© !\nüìö Mati√®re: ${subjectText}\nüéØ Niveau: ${difficultyText}`);
      console.log('Exam payload =>', payload);
    }

    function goBack() {
      window.location.href = '/';
    }

    // D√©marrage quand le DOM est pr√™t
    document.addEventListener('DOMContentLoaded', () => {
      addQuestion();
      
      // G√©rer le changement de mati√®re
      document.getElementById('subject-select').addEventListener('change', function(e) {
        currentSubject = e.target.value;
        updateQuestionStyles();
      });
    });
    
document.addEventListener('DOMContentLoaded', () => {
  const subjectSel = document.getElementById('subject-select');
  if (subjectSel) {
    currentSubject = subjectSel.value || 'other';
    subjectSel.addEventListener('change', () => {
      currentSubject = subjectSel.value || 'other';
      // (optionnel) adapter le th√®me/classe CSS selon la mati√®re ici
    });
  }
});


  </script>
</body>
</html>