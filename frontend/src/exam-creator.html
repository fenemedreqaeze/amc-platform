<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cr√©ateur d'examen</title>
  <style>
    :root {
      --bg: #0f172a;         /* slate-900 */
      --card: #111827;       /* gray-900 */
      --muted: #1f2937;      /* gray-800 */
      --text: #e5e7eb;       /* gray-200 */
      --soft: #9ca3af;       /* gray-400 */
      --primary: #60a5fa;    /* blue-400 */
      --primary-600: #2563eb;/* blue-600 */
      --success: #22c55e;    /* green-500 */
      --danger: #ef4444;     /* red-500 */
      --danger-600: #dc2626; /* red-600 */
      --shadow: rgba(0,0,0,.35);
    }

    html, body { margin: 0; padding: 0; background: var(--bg); color: var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, sans-serif; }

    .container { max-width: 980px; margin: 32px auto; padding: 0 16px; }

    h1 { font-size: 28px; font-weight: 700; margin: 0 0 20px; letter-spacing: .3px; }
    h3 { margin: 0 0 12px; font-size: 18px; }

    .question-card {
      background: var(--card);
      border: 1px solid var(--muted);
      border-radius: 14px;
      padding: 16px;
      margin: 16px 0;
      box-shadow: 0 6px 20px var(--shadow);
    }

    textarea {
      width: 100%;
      resize: vertical;
      background: #0b1220;
      color: var(--text);
      border: 1px solid var(--muted);
      border-radius: 10px;
      padding: 10px 12px;
      margin-bottom: 12px;
      outline: none;
    }

    .answer-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 8px 0;
      padding: 10px;
      background: #0b1220;
      border: 1px solid var(--muted);
      border-radius: 10px;
    }

    .answer-row.correct-answer { border-color: var(--primary); box-shadow: inset 0 0 0 1px rgba(96,165,250,.35); }

    .answer-row input[type="text"] {
      background: transparent;
      border: none;
      border-left: 1px solid var(--muted);
      padding: 8px 10px;
      color: var(--text);
      outline: none;
    }

    .btn-primary, .btn-success, .btn-danger {
      border: none;
      border-radius: 12px;
      padding: 10px 14px;
      cursor: pointer;
      font-weight: 600;
      color: white;
      transition: transform .04s ease, filter .08s ease, opacity .2s ease;
    }

    .btn-primary { background: var(--primary-600); }
    .btn-success { background: var(--success); color: #052e0f; }
    .btn-danger { background: var(--danger); }

    .btn-primary:active, .btn-success:active, .btn-danger:active { transform: translateY(1px); }
    .btn-danger:hover { filter: brightness(.95); }

    .actions { text-align: center; margin-top: 24px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }

    .sub-actions { display: flex; gap: 8px; margin-top: 10px; }

    .note { color: var(--soft); font-size: 13px; margin-top: 8px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Cr√©ateur d'examen</h1>

    <div id="questions-container"></div>

    <!-- Boutons d'action -->
    <div class="actions">
      <button type="button" class="btn-success" onclick="addQuestion()">‚ûï Ajouter une Question</button>
      <button type="button" class="btn-primary" onclick="saveExam()">üíæ Sauvegarder l'Examen</button>
      <button type="button" class="btn-primary" onclick="goBack()">‚Üê Retour √† l'accueil</button>
    </div>

    <p class="note">Astuce¬†: marque la bonne r√©ponse en cochant le bouton radio correspondant. Tu peux ajouter/supprimer des r√©ponses librement.</p>
  </div>

  <script>
    let questionCount = 0;

    function addQuestion() {
      questionCount++;
      const questionsContainer = document.getElementById('questions-container');

      const questionDiv = document.createElement('div');
      questionDiv.className = 'question-card';
      questionDiv.id = `question-${questionCount}`;
      questionDiv.innerHTML = `
        <h3>Question ${questionCount}</h3>
        <textarea placeholder="√ânonc√© de la question..." rows="3"></textarea>

        <div class="answer-row correct-answer">
          <input type="radio" name="correct-${questionCount}" checked>
          <input type="text" placeholder="R√©ponse correcte" style="flex: 1;">
          <button type="button" class="btn-danger answer-remove">‚úï</button>
        </div>

        <div class="answer-row">
          <input type="radio" name="correct-${questionCount}">
          <input type="text" placeholder="Mauvaise r√©ponse" style="flex: 1;">
          <button type="button" class="btn-danger answer-remove">‚úï</button>
        </div>

        <div class="sub-actions">
          <button type="button" class="btn-success add-answer-btn" data-id="${questionCount}">‚ûï Ajouter une r√©ponse</button>
          <button type="button" class="btn-danger remove-question-btn" data-id="${questionCount}">üóëÔ∏è Supprimer cette question</button>
        </div>
      `;

      questionsContainer.appendChild(questionDiv);

      // === √âV√âNEMENTS SP√âCIFIQUES √Ä CETTE QUESTION ===

      // 1) Ajouter une r√©ponse
      const addBtn = questionDiv.querySelector('.add-answer-btn');
      addBtn.addEventListener('click', function (e) {
        e.stopPropagation();
        addAnswer(this.getAttribute('data-id'));
      });

      // 2) Supprimer la question (un seul handler, pas de handler g√©n√©rique)
      const removeBtn = questionDiv.querySelector('.remove-question-btn');
      removeBtn.addEventListener('click', function (e) {
        e.stopPropagation();
        removeQuestion(this.getAttribute('data-id'));
      });

      // 3) Supprimer une r√©ponse (ne cible QUE les boutons de ligne-r√©ponse)
      const answerDeleteBtns = questionDiv.querySelectorAll('.answer-remove');
      answerDeleteBtns.forEach(btn => {
        btn.addEventListener('click', function (e) {
          e.stopPropagation();
          this.parentElement.remove();
        });
      });

      // 4) Styling visuel de la bonne r√©ponse
      const radios = questionDiv.querySelectorAll(`input[type="radio"][name="correct-${questionCount}"]`);
      radios.forEach(r => {
        r.addEventListener('change', () => {
          questionDiv.querySelectorAll('.answer-row').forEach(row => row.classList.remove('correct-answer'));
          const row = r.closest('.answer-row');
          if (row) row.classList.add('correct-answer');
        });
      });
    }

    function addAnswer(questionId) {
      const question = document.getElementById(`question-${questionId}`);
      if (!question) return;

      const newAnswer = document.createElement('div');
      newAnswer.className = 'answer-row';
      newAnswer.innerHTML = `
        <input type="radio" name="correct-${questionId}">
        <input type="text" placeholder="Nouvelle r√©ponse" style="flex: 1;">
        <button type="button" class="btn-danger answer-remove">‚úï</button>
      `;

      // Supprimer cette r√©ponse
      newAnswer.querySelector('.answer-remove').addEventListener('click', function (e) {
        e.stopPropagation();
        this.parentElement.remove();
      });

      // Mettre en surbrillance si coch√©e
      const radio = newAnswer.querySelector('input[type="radio"]');
      radio.addEventListener('change', () => {
        question.querySelectorAll('.answer-row').forEach(row => row.classList.remove('correct-answer'));
        newAnswer.classList.add('correct-answer');
      });

      // Ins√©rer juste avant les sous-actions (boutons Ajouter/Supprimer)
      const subActions = question.querySelector('.sub-actions');
      question.insertBefore(newAnswer, subActions);
    }

    function removeQuestion(questionId) {
      const node = document.getElementById(`question-${questionId}`);
      if (node) node.remove();
    }

    function saveExam() {
      // Esquisse de s√©rialisation (pour plus tard)
      const payload = { questions: [] };
      document.querySelectorAll('.question-card').forEach((qCard, idx) => {
        const statement = qCard.querySelector('textarea')?.value || '';
        const answers = [];
        const name = `correct-${idx + 1}`;
        const correctIndex = Array.from(qCard.querySelectorAll(`input[type="radio"][name="${name}"]`)).findIndex(r => r.checked);
        qCard.querySelectorAll('.answer-row').forEach((row) => {
          const text = row.querySelector('input[type="text"]').value || '';
          answers.push(text);
        });
        payload.questions.push({ statement, answers, correctIndex });
      });

      // Pour l'instant, simple aper√ßu
      alert('üéâ Examen sauvegard√© (aper√ßu JSON dans la console).');
      console.log('Exam payload =>', payload);
    }

    function goBack() {
      // Adapte si besoin selon ton routage
      window.location.href = '/';
    }

    // D√©marrage quand le DOM est pr√™t
    document.addEventListener('DOMContentLoaded', () => {
      addQuestion();
    });
  </script>
</body>
</html>
