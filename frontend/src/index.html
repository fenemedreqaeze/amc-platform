<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>AMC Platform</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
            color: white;
            text-align: center;
        }
        h1 {
            font-size: 3em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .subtitle {
            font-size: 1.2em;
            margin-bottom: 40px;
            opacity: 0.9;
        }
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }
        .card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.3s ease;
            cursor: pointer;
        }
        .card:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.15);
        }
        .card h3 {
            margin-top: 0;
            font-size: 1.5em;
        }
        .status {
            margin-top: 30px;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            display: inline-block;
        }
        .pdf-status {
            margin-top: 15px;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ AMC Platform</h1>
        <div class="subtitle">Plateforme de cr√©ation et correction automatique de QCM</div>

        <div class="card-grid">
            <div class="card" onclick="showExamCreator()">
                <h3>üìù Cr√©er un Examen</h3>
                <p>Cr√©ez un nouveau QCM avec interface intuitive</p>
            </div>
            <div class="card" onclick="showExamsList()">
                <h3>üìã Mes Examens</h3>
                <p>G√©rez vos examens existants</p>
            </div>
            <div class="card" onclick="showCorrection()">
                <h3>üìä Corriger</h3>
                <p>Corrigez automatiquement les copies scann√©es</p>
            </div>
            <div class="card" onclick="showResults()">
                <h3>üìà R√©sultats</h3>
                <p>Analysez les statistiques et performances</p>
            </div>
        </div>

        <p style="margin-top:40px;">
<a id="view-pdf-btn"
   href="#"
   style="display:none;
          margin-top:20px;
          background:#fff;
          color:#111827;
          padding:10px 16px;
          border-radius:10px;
          text-decoration:none;
          font-weight:600;
          display:none;">
  üìÑ Voir le PDF de l'examen
</a>
        </p>

        <div class="pdf-status" id="pdf-status">üîÑ Pr√©paration...</div>
        <div class="status" id="status">üîÑ V√©rification de la connexion...</div>
    </div>

    <script>
        // V√©rification de l'API
        fetch('/api/health')
            .then(r => r.json())
            .then(data => {
                document.getElementById('status').innerHTML = '‚úÖ Backend connect√© - ' + data.status;
            })
            .catch(err => {
                document.getElementById('status').innerHTML = '‚ùå Erreur de connexion au backend';
            });

        let currentProjectId = localStorage.getItem('currentProjectId');

        function showExamCreator() {
             if (currentProjectId) {
        // Projet d√©j√† pr√™t -> on va direct sur le cr√©ateur
        window.location.href = '/exam-creator.html';
            } else {
        // Pas encore de projet -> on le cr√©e puis on redirige
        createProjectForExamCreator();
            }
}

        function showExamsList() {
            alert('üìã Liste des examens - √Ä impl√©menter !');
        }

        function showCorrection() {
            alert('üìù Correction - √Ä impl√©menter !');
        }

        function showResults() {
            alert('üìä R√©sultats - √Ä impl√©menter !');
        }

        async function createProjectForExamCreator() {
            try {
                document.getElementById('pdf-status').innerHTML = 'üîÑ Cr√©ation du projet...';
                
                if (!currentProjectId) {
                    const response = await fetch('/api/projects', { method: 'POST' });
                    const data = await response.json();
                    currentProjectId = data.project_id;
                    localStorage.setItem('currentProjectId', currentProjectId);
                }
                
                document.getElementById('pdf-status').innerHTML = '‚úÖ Redirection...';
                
                setTimeout(() => {
                    window.location.href = '/exam-creator.html';
                }, 500);
                
            } catch (error) {
                document.getElementById('pdf-status').innerHTML = '‚ùå Erreur cr√©ation projet';
            }
        }

async function updatePDFButton(projectId) {
  const pdfBtn = document.getElementById('view-pdf-btn');
  if (!pdfBtn || !projectId) return;

  try {
    // Demander √† l‚ÄôAPI la liste des PDFs du projet
    const res = await fetch('/api/projects/' + projectId + '/pdfs');
    const pdfList = await res.json();

    // V√©rifie que la liste existe et qu'il y a au moins 1 PDF
    if (pdfList && Array.isArray(pdfList) && pdfList.length > 0) {
      const pdfName = pdfList[0];  // On prend le premier PDF trouv√©

      // Met √† jour automatiquement l‚ÄôURL sans nom en dur
      pdfBtn.href = '/api/projects/' + projectId + '/pdf/' + pdfName;
      pdfBtn.textContent = 'üìÑ Voir le PDF : ' + pdfName;
      pdfBtn.style.display = 'inline-block';
    } else {
      pdfBtn.style.display = 'none';
    }

  } catch (err) {
    console.error('Erreur r√©cup√©ration PDF:', err);
    pdfBtn.style.display = 'none';
  }
}


document.addEventListener('DOMContentLoaded', function() {
    if (currentProjectId) {
        // On a d√©j√† un projet ‚Üí on met √† jour le bouton PDF et le statut
        updatePDFButton(currentProjectId);
        document.getElementById('pdf-status').innerHTML =
            '‚úÖ Projet recharg√© : ' + currentProjectId;
    } else {
        // Pas encore de projet
        document.getElementById('pdf-status').innerHTML =
            '‚ÑπÔ∏è Cliquez sur "Cr√©er un Examen" pour cr√©er un projet';
    }
});
    </script>
</body>
</html>